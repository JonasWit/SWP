
<div class="row">
    <div class="col-md-6">
        <RadzenGrid @ref="App.ProductivityPage.TimeRecordsGrid" AllowFiltering="true" AllowPaging="true" PageSize="10" AllowSorting="true"
                    Data="@(App.ProductivityPage.SelectedMonth == null ? App.ActiveClientWithData.TimeRecords : App.ActiveClientWithData.TimeRecords.Where(x => x.EventDate.Month == App.ProductivityPage.SelectedMonth.Month &&  x.EventDate.Year == App.ProductivityPage.SelectedMonth.Year))" TItem="TimeRecordViewModel" RowUpdate="@App.ProductivityPage.OnUpdateTimeRecordRow" RowSelect="@(args => App.ProductivityPage.ActiveTimeRecordChange(args))">
            <Columns>
                <RadzenGridColumn TItem="TimeRecordViewModel" Property="Name" Title="Nazwa">
                    <EditTemplate Context="r">
                        <RadzenTextBox @bind-Value="r.Name" Style="width:100%; display: block" Name="Name" />
                        <RadzenRequiredValidator Component="Name" Text="Nazwa nie może być pusta" Popup="true" />
                        <RadzenLengthValidator Max="50" Text="Maksymalnie 50 znaków" Component="Name" Popup="true" />
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="TimeRecordViewModel" Property="Lawyer" Title="Prawnik">
                    <EditTemplate Context="r">
                        <RadzenTextBox @bind-Value="r.Lawyer" Style="width:100%; display: block" Name="Lawyer" />
                        <RadzenRequiredValidator Component="Lawyer" Text="Wpisz prawnika, który pracował w tym czasie" Popup="true" />
                        <RadzenLengthValidator Max="200" Text="Maksymalnie 200 znaków" Component="Lawyer" Popup="true" />
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="TimeRecordViewModel" Property="Description" Title="Opis">
                    <EditTemplate Context="r">
                        <RadzenTextArea @bind-Value="r.Description" Style="width:100%; display: block" Name="Description" />
                        <RadzenLengthValidator Max="500" Text="Maksymalnie 500 znaków!" Component="Description" Popup="true" />
                    </EditTemplate>
                </RadzenGridColumn>

                <RadzenGridColumn TItem="TimeRecordViewModel" Property="RecordedHours" Title="Godziny">
                    <EditTemplate Context="r">
                        <RadzenNumeric TValue="int" Step="1" @bind-Value="@r.RecordedHours" Name="Hours" Placeholder="0" />
                        <RadzenRequiredValidator Text="Czas musi być wprowadzony!" Component="Hours" Popup="true" />
                        <RadzenNumericRangeValidator Component="Hours" Min="0" Text="Wartość dla godzin nie może być mniejsza od zera!" Style="position: absolute" />
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="TimeRecordViewModel" Property="RecordedMinutes" Title="Minuty">
                    <EditTemplate Context="r">
                        <RadzenNumeric TValue="int" Step="1" @bind-Value="@r.RecordedMinutes" Name="Minutes" Placeholder="1" />
                        <RadzenRequiredValidator Text="Czas musi być wprowadzony!" Component="Minutes" Popup="true" />
                        <RadzenNumericRangeValidator Component="Minutes" Min="0" Text="Wartość dla minut nie może być mniejsza od zera!" Style="position: absolute" />
                        <RadzenNumericRangeValidator Component="Minutes" Max="59" Text="Wartość dla minut nie może być większa od 59!" Style="position: absolute" />
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="TimeRecordViewModel" Property="Rate" Title="Stawka">
                    <EditTemplate Context="r">
                        <RadzenNumeric TValue="double" Step="0.01" @bind-Value="@r.Rate" Name="Rate" Placeholder="0.00" />
                        <RadzenNumericRangeValidator Component="Rate" Min="0" Text="Stawka nie może być mniejsza od zera!" Style="position: absolute" />
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="TimeRecordViewModel" Property="Total" Title="Suma" />

                <RadzenGridColumn TItem="TimeRecordViewModel" Property="EventDate" Title="Data">
                    <Template Context="r">
                        @String.Format("{0:d}", r.EventDate)
                    </Template>
                    <EditTemplate Context="r">
                        <RadzenDatePicker @bind-Value="r.EventDate" Name="EventDate" DateFormat="dd/MM/yyyy" />
                        <RadzenRequiredValidator Component="EventDate" Text="Data nie może być pusta!" Popup="true" />
                    </EditTemplate>
                    <FilterTemplate>
                        <RadzenDropDown AllowClear="true" TValue="int"
                                        FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" FilterOperator="StringFilterOperator.StartsWith" AllowFiltering="true"
                                        Data="@App.ProductivityPage.MonthsFilterData" TextProperty="DisplayText" ValueProperty="Id" Change="@(args => App.ProductivityPage.SelectedMonthChange(args))" />
                    </FilterTemplate>
                </RadzenGridColumn>

                <RadzenGridColumn TItem="TimeRecordViewModel" Bubble="false" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Width="100px">
                    <Template Context="r">
                        <RadzenButton Icon="edit" Size="ButtonSize.Medium" Click="@(args => App.ProductivityPage.EditTimeRecordRow(r))">
                        </RadzenButton>
                    </Template>
                    <EditTemplate Context="r">
                        <RadzenButton Icon="save" Size="ButtonSize.Medium" Click="@((args) => App.ProductivityPage.SaveTimeRecordRow(r))">
                        </RadzenButton>
                        <RadzenButton Icon="cancel" Size="ButtonSize.Medium" ButtonStyle="ButtonStyle.Success" Click="@((args) => App.ProductivityPage.CancelTimeRecordEdit(r))">
                        </RadzenButton>
                    </EditTemplate>
                </RadzenGridColumn>
                <RadzenGridColumn TItem="TimeRecordViewModel" Context="order" Bubble="false" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Width="50px">
                    <Template Context="r">
                        <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="close" Size="ButtonSize.Medium" Click="@(async (args) => await App.ProductivityPage.DeleteTimeRecordRow(r))">
                        </RadzenButton>
                    </Template>
                    <EditTemplate Context="r">
                    </EditTemplate>
                </RadzenGridColumn>
            </Columns>
        </RadzenGrid>
    </div>
    <div class="col-md-6">
        <RadzenCard Style="margin-bottom:20px">
            Klient: <b>@App.ActiveClient.Name</b>
            Poświęcony czas: <b>@App.ActiveClientWithData.GetTimeSpent()</b>
        </RadzenCard>
        <RadzenCard>
            <div class="row">
                @if (App.ActiveClientWithData.SelectedTimeRecord != null)
                {
                    <div class="col-md-6">
                        <div>Nazwa:</div>
                        <b>@App.ActiveClientWithData.SelectedTimeRecord.Name</b>
                        <div>Opis:</div>
                        <b>@App.ActiveClientWithData.SelectedTimeRecord.Description</b>
                    </div>
                }
                else
                {
                    <p>Wybierz kwotę!</p>
                }
            </div>
        </RadzenCard>

        <RadzenCard>
            <RadzenTemplateForm Data="@App.ProductivityPage.NewTimeRecord" Submit="@(async (CreateTimeRecord.Request args) => { await App.ProductivityPage.SubmitNewTimeRecord(args); })">
                <div class="row">
                    <RadzenFieldset Text="Wprowadź nową czynność i czas">
                        <div class="row">
                            <div class="col-md-8 m-5">
                                <RadzenTextBox Placeholder="Nazwa Srawy..." Style="margin-bottom: 30px" @bind-Value="App.ProductivityPage.NewTimeRecord.Name" Name="Name" />
                                <RadzenRequiredValidator Text="Nazwa nie może być pusta!" Component="Name" Popup="true" />
                                <RadzenLengthValidator Max="50" Text="Maksymalnie 50 znaków!" Component="Name" Popup="true" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8 m-5">
                                <RadzenTextArea Placeholder="Opis..." Style="margin-bottom: 30px" @bind-Value="App.ProductivityPage.NewTimeRecord.Description" Name="Description" />
                                <RadzenLengthValidator Max="500" Text="Maksymalnie 500 znaków" Component="Description" Popup="true" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-8 m-5">
                                <RadzenTextArea Placeholder="Prawnik..." Style="margin-bottom: 30px" @bind-Value="App.ProductivityPage.NewTimeRecord.Lawyer" Name="Lawyer" />
                                <RadzenLengthValidator Max="200" Text="Maksymalnie 200 znaków" Component="Lawyer" Popup="true" />
                            </div>
                        </div>
                        <div class="row">

                            <RadzenLabel Text="Godziny"></RadzenLabel>
                            <RadzenNumeric TValue="int" Style="margin-bottom: 20px" @bind-Value="App.ProductivityPage.NewTimeRecord.RecordedHours" Name="Hours" Placeholder="0" />
                            <RadzenRequiredValidator Text="Czas musi być wprowadzony!" Component="Hours" Popup="true" />
                            <RadzenNumericRangeValidator Component="Hours" Min="0" Text="Wartość dla godzin nie może być mniejsza od zera!" Style="position: absolute" />

                            <RadzenLabel Text="Stawka"></RadzenLabel>
                            <RadzenNumeric TValue="double" Placeholder="0.0" Step="0.01" @bind-Value="@App.ProductivityPage.NewTimeRecord.Rate" Style="margin-bottom: 20px" />

                            <RadzenLabel Text="Minuty"></RadzenLabel>
                            <RadzenNumeric TValue="int" Style="margin-bottom: 20px" @bind-Value="App.ProductivityPage.NewTimeRecord.RecordedMinutes" Name="Minutes" Placeholder="1" />
                            <RadzenRequiredValidator Text="Czas musi być wprowadzony!" Component="Minutes" Popup="true" />
                            <RadzenNumericRangeValidator Component="Minutes" Min="0" Text="Wartość dla minut nie może być mniejsza od zera!" Style="position: absolute" />
                            <RadzenNumericRangeValidator Component="Minutes" Max="59" Text="Wartość dla minut nie może być większa od 59!" Style="position: absolute" />
                        </div>
                        <div class="row">

                            <h3>Data</h3>
                            <RadzenDatePicker @bind-Value="App.ProductivityPage.NewTimeRecord.EventDate" DateFormat="d" Name="EventDate" />
                            <RadzenRequiredValidator Component="EventDate" Text="Data nie może być pusta!" Popup="true" />
                        </div>
                    </RadzenFieldset>
                </div>
                <div class="row justify-content-center">
                    <div class="col-md-12 d-flex align-items-end justify-content-center" style="margin-top: 16px;">
                        <RadzenButton ButtonStyle="ButtonStyle.Secondary" ButtonType="ButtonType.Submit" Icon="save" Text="Zapisz" />
                    </div>
                </div>
            </RadzenTemplateForm>
        </RadzenCard>

        <RadzenCard>
            <RadzenTemplateForm Data="@App.ProductivityPage.NewTimesheetReport" Submit="@(async (LegalTimeSheetReport.ReportData args) => { await App.ProductivityPage.GenerateTimesheetReport(args); })">
                <div class="row">
                    <RadzenFieldset Text="Wprowadź nową czynność i czas">
                        <div class="row">
                            <div class="col-md-8 m-5">
                                <RadzenLabel Text="NIP" Component="NIP" Style="margin-left: 5px;margin-bottom: 20px" />
                                <RadzenMask Mask="***-**-**-***" Pattern="[^0-9]" Placeholder="000-00-00-000" Name="NIP" @bind-Value="@App.ProductivityPage.NewTimesheetReport.NIP" Style="margin-bottom: 20px" />
                            </div>
                        </div>

                        <RadzenLabel Text="Numer Faktury" Component="InvoiceNo" Style="margin-left: 5px;margin-bottom: 20px" />
                        <RadzenTextArea Placeholder="Numer Faktury..." Style="margin-bottom: 30px" @bind-Value="App.ProductivityPage.NewTimesheetReport.InvoiceNumber" Name="InvoiceNo" />

                        <RadzenLabel Text="Uzyj tego przefiltrowanego miesiaca" Component="UseSelected" Style="margin-left: 5px;margin-bottom: 20px" />
                        <RadzenCheckBox @bind-Value="@App.ProductivityPage.NewTimesheetReport.UseSelectedMonth" Style="margin-bottom: 20px" TValue="bool" Name="UseSelected" />

                        <RadzenLabel Text="Data Faktury" Component="InvoiceDate" Style="margin-left: 5px;margin-bottom: 20px" />
                        <RadzenDatePicker @bind-Value="App.ProductivityPage.NewTimesheetReport.InvoiceDate" DateFormat="d" Name="InvoiceDate" />
                        <RadzenRequiredValidator Component="InvoiceDate" Text="Data Faktury nie moze byc pusta!" Popup="true" />

                        <RadzenLabel Text="Data Początkowa" Component="StartDate" Style="margin-left: 5px;margin-bottom: 20px" />
                        <RadzenDatePicker @bind-Value="App.ProductivityPage.NewTimesheetReport.StartDate" DateFormat="d" Name="StartDate" />

                        <RadzenLabel Text="Data Końcowa" Component="EndDate" Style="margin-left: 5px;margin-bottom: 20px" />
                        <RadzenDatePicker @bind-Value="App.ProductivityPage.NewTimesheetReport.EndDate" DateFormat="d" Name="EndDate" />

                    </RadzenFieldset>
                </div>
                <div class="row justify-content-center">
                    <div class="col-md-12 d-flex align-items-end justify-content-center" style="margin-top: 16px;">
                        <RadzenButton ButtonStyle="ButtonStyle.Secondary" ButtonType="ButtonType.Submit" Icon="save" Text="Zapisz" />
                    </div>
                </div>
            </RadzenTemplateForm>

        </RadzenCard>
    </div>
</div>
