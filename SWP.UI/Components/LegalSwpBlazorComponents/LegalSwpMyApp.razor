@using System.Globalization

<h1>Moja Aplikacja</h1>

<RadzenButton ButtonStyle="ButtonStyle.Secondary" Click="App.MyAppPage.RefreshData">Odśwież Dane</RadzenButton>

<RadzenListBox AllowFiltering="true" @bind-Value="RelatedUsersFilterValue" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" Data="@App.User.RelatedUsers" TextProperty="UserName" ValueProperty="Id" Style="margin-bottom: 20px; height:200px;" Change="@(args => App.MyAppPage.SelectedUserChange(args))"/>

@if (App.MyAppPage.SelectedUser != null &&
    App.User.RootClient && 
    App.ActiveUserId != App.MyAppPage.SelectedUser.Id)
{
    <h1>Mozna skasowac</h1>
    <RadzenButton Text="Usuń powiązanie!" Click="App.MyAppPage.RemoveRelation"></RadzenButton>
}

@if (App.Clients.Count != 0)
{
    <div class="row">
        <RadzenChart ColorScheme="@App.MyAppPage.ColorScheme">
            <RadzenPieSeries Data="@App.MyAppPage.ClientsCases" Title="Sprawy" CategoryProperty="Category" ValueProperty="Number" />
        </RadzenChart>
    </div>

    <div style="width: 1000px; height:1000px">
        <RadzenChart ColorScheme="@App.MyAppPage.ColorScheme">
            @foreach (var data in App.MyAppPage.RevenueData)
            {
                <RadzenLineSeries Smooth="true" Data="@data.DataByDate" CategoryProperty="Date" Title="@data.Name" LineType="LineType.Solid" ValueProperty="Number">
                    <RadzenMarkers MarkerType="MarkerType.Circle" />
                </RadzenLineSeries>
            }
            <RadzenCategoryAxis Padding="20" FormatString="{0:MMM}" />
            <RadzenValueAxis Formatter="@FormatAsPLN">
                <RadzenGridLines Visible="true" />
                <RadzenAxisTitle Text="Bilans w PLN" />
            </RadzenValueAxis>
        </RadzenChart>
    </div>

    @if (App.ActiveClient != null)
    {

        <p>active client : @App.ActiveClient.Name</p>





    }
    else
    {
        <p>No active client</p>


    }
}
else
{




}

@code {
    [Parameter]
    public LegalBlazorApp App { get; set; }
    [Parameter]
    public EventCallback<LegalBlazorApp> AppChanged { get; set; }

    private string FormatAsPLN(object value) => ((double)value).ToString("C0", CultureInfo.CreateSpecificCulture("pl"));

    private string RelatedUsersFilterValue = "";
}
